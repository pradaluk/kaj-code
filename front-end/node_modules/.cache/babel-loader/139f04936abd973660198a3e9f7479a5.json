{"ast":null,"code":"import _asyncToGenerator from\"E:/School/Bcc/bakalarka/appka/race-react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"E:/School/Bcc/bakalarka/appka/race-react/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"E:/School/Bcc/bakalarka/appka/race-react/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"E:/School/Bcc/bakalarka/appka/race-react/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"E:/School/Bcc/bakalarka/appka/race-react/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"E:/School/Bcc/bakalarka/appka/race-react/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import _regeneratorRuntime from\"E:\\\\School\\\\Bcc\\\\bakalarka\\\\appka\\\\race-react\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import'../styles/Race.css';import React,{Component}from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Race=/*#__PURE__*/function(_Component){_inherits(Race,_Component);var _super=_createSuper(Race);function Race(props){var _this;_classCallCheck(this,Race);_this=_super.call(this,props);_this.downloadResFile=function(){console.log(_this.props.data.results);var element=document.createElement(\"a\");var file=new Blob([JSON.stringify(_this.props.data.results,null,4)],{type:'text/plain'});element.href=URL.createObjectURL(file);element.download=\"myFile.txt\";document.body.appendChild(element);// Required for this to work in FireFox\nelement.click();};_this.handleChangeFile=function(file){var fileData=new FileReader();fileData.onloadend=_this.handleFile;fileData.readAsText(file);};_this.handleFile=function(e){var content=e.target.result;console.log(content);var resultArray=JSON.parse(content);console.log(resultArray);resultArray.forEach(function(res){_this.updateResult(res);});// You can set content in state and show it in render.\n};_this.state={show:false,isRegistered:false,mycars:[],carOptions:[],carId:0};_this.renderDelete=_this.renderDelete.bind(_assertThisInitialized(_this));_this.renderInput=_this.renderInput.bind(_assertThisInitialized(_this));_this.fetchMyCars=_this.fetchMyCars.bind(_assertThisInitialized(_this));return _this;}_createClass(Race,[{key:\"renderDelete\",value:function renderDelete(){var _this2=this;if(this.props.data.organizor&&this.props.user.id===this.props.data.organizor.id||this.props.user.id===this.props.data.organizor||this.props.user.role===\"ADMIN\"){return/*#__PURE__*/_jsx(\"button\",{className:\"delete-button\",onClick:function onClick(){_this2.DeleteRace();},children:\"DELETE\"});}else{return;}}},{key:\"renderInput\",value:function renderInput(){var _this3=this;if(this.props.data.organizor&&this.props.user.id===this.props.data.organizor.id||this.props.user.id===this.props.data.organizor||this.props.user.role===\"ADMIN\"){return/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"file-input\",children:[\"SELECT FILE\",/*#__PURE__*/_jsx(\"input\",{id:\"file-input\",type:\"file\",accept:\".txt\",onChange:function onChange(e){return _this3.handleChangeFile(e.target.files[0]);}})]});}else{return;}}},{key:\"isRegistered\",value:function isRegistered(){var _this4=this;this.props.data.results.forEach(function(element){if(element.user.id===_this4.props.user.id||element.user===_this4.props.user.id){_this4.setState({isRegistered:true});}});}},{key:\"updateResult\",value:function(){var _updateResult=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(res){var restURL;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:restURL=\"http://localhost:8081/race/rest/results/\";_context.next=3;return fetch(restURL,{method:\"PUT\",credentials:'include',headers:{'Accept':'application/json','Content-Type':'application/json'},body:JSON.stringify({user:{id:res.user.id},race:{id:res.race},startPos:res.startPos,finishPos:res.finishPos})});case 3:case\"end\":return _context.stop();}}},_callee);}));function updateResult(_x){return _updateResult.apply(this,arguments);}return updateResult;}()},{key:\"DeleteRace\",value:function(){var _DeleteRace=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var restURL;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:restURL=\"http://localhost:8081/race/rest/races/\"+this.props.data.id;_context2.next=3;return fetch(restURL,{method:\"DELETE\",credentials:'include',headers:{'Accept':'application/json','Content-Type':'application/json'}});case 3:window.location.assign(\"/upcomingraces\");case 4:case\"end\":return _context2.stop();}}},_callee2,this);}));function DeleteRace(){return _DeleteRace.apply(this,arguments);}return DeleteRace;}()},{key:\"componentDidMount\",value:function componentDidMount(){this.isRegistered();this.fetchMyCars();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){}},{key:\"fetchMyCars\",value:function(){var _fetchMyCars=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _this5=this;var restURL,carOptionsList;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:restURL=\"http://localhost:8081/race/rest/cars/getMyCars\";_context3.next=3;return fetch(restURL,{method:\"GET\",credentials:'include',headers:{'Accept':'application/json'}}).then(function(response){return response.json();}).then(function(data){_this5.setState({mycars:data});});case 3:carOptionsList=[];Array.from(this.state.mycars).forEach(function(car){carOptionsList.push(/*#__PURE__*/_jsxs(\"option\",{value:car.id,children:[car.maker,\" \",car.model]},car.id));});this.setState({carOptions:carOptionsList});if(this.state.mycars[0]){this.setState({carId:this.state.mycars[0].id});}case 7:case\"end\":return _context3.stop();}}},_callee3,this);}));function fetchMyCars(){return _fetchMyCars.apply(this,arguments);}return fetchMyCars;}()},{key:\"Register\",value:function(){var _Register=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var restURL;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:restURL=\"http://localhost:8081/race/rest/users/registerForRace/\"+this.props.data.id+\"/\"+this.state.carId;_context4.next=3;return fetch(restURL,{method:\"POST\",credentials:'include',headers:{'Accept':'application/json'}});case 3:window.location.assign(\"/upcomingraces\");case 4:case\"end\":return _context4.stop();}}},_callee4,this);}));function Register(){return _Register.apply(this,arguments);}return Register;}()},{key:\"Withdraw\",value:function(){var _Withdraw=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var restURL;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:restURL=\"http://localhost:8081/race/rest/users/withdraw/\"+this.props.data.id;_context5.next=3;return fetch(restURL,{method:\"POST\",credentials:'include',headers:{'Accept':'application/json'}});case 3:window.location.assign(\"/upcomingraces\");case 4:case\"end\":return _context5.stop();}}},_callee5,this);}));function Withdraw(){return _Withdraw.apply(this,arguments);}return Withdraw;}()},{key:\"handleChangeCar\",value:function handleChangeCar(value){this.setState({carId:value});}},{key:\"render\",value:function render(){var _this6=this;if(this.state.isRegistered){return/*#__PURE__*/_jsxs(\"div\",{className:\"Race\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"Name\",children:this.props.data.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"RegDrivers\",children:[\"Registered : \",this.props.data.results.length,\" / \",this.props.data.maxDrivers]}),/*#__PURE__*/_jsxs(\"p\",{className:\"Circuit\",children:[\"Circuit : \",this.props.data.circuit.name]}),/*#__PURE__*/_jsxs(\"p\",{className:\"Date\",children:[\"Date of race : \",this.props.data.race_date]}),/*#__PURE__*/_jsxs(\"p\",{className:\"eorDate\",children:[\"End of registrations : \",this.props.data.eor_date]}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"reg-button\",onClick:function onClick(){_this6.Withdraw();},children:\"WITHDRAW\"}),/*#__PURE__*/_jsx(\"button\",{className:\"details-button\",onClick:function onClick(){_this6.props.showDetails(_this6.props.data);},children:\"DETAILS\"}),/*#__PURE__*/_jsx(this.renderDelete,{}),/*#__PURE__*/_jsx(\"button\",{onClick:this.downloadResFile,children:\"DOWNLOAD RESULTS\"})]}),/*#__PURE__*/_jsx(this.renderInput,{})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"Race\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"Name\",children:this.props.data.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"RegDrivers\",children:[\"Registered : \",this.props.data.results.length,\" / \",this.props.data.maxDrivers]}),/*#__PURE__*/_jsxs(\"p\",{className:\"Circuit\",children:[\"Circuit : \",this.props.data.circuit.name]}),/*#__PURE__*/_jsxs(\"p\",{className:\"Date\",children:[\"Date of race : \",this.props.data.race_date]}),/*#__PURE__*/_jsxs(\"p\",{className:\"eorDate\",children:[\"End of registrations : \",this.props.data.eor_date]}),/*#__PURE__*/_jsx(\"p\",{children:\"Select your car : \"}),/*#__PURE__*/_jsx(\"select\",{className:\"carClass-select\",onChange:function onChange(event){return _this6.handleChangeCar(event.target.value);},children:this.state.carOptions}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"reg-button\",onClick:function onClick(){_this6.Register();},children:\"REGISTER\"}),/*#__PURE__*/_jsx(\"button\",{className:\"details-button\",onClick:function onClick(){_this6.props.showDetails(_this6.props.data);},children:\"DETAILS\"}),/*#__PURE__*/_jsx(this.renderDelete,{}),/*#__PURE__*/_jsx(\"button\",{onClick:this.downloadResFile,children:\"DOWNLOAD RESULTS\"})]}),/*#__PURE__*/_jsx(this.renderInput,{})]});}}]);return Race;}(Component);export default Race;","map":{"version":3,"sources":["E:/School/Bcc/bakalarka/appka/race-react/src/components/Race.js"],"names":["React","Component","Race","props","downloadResFile","console","log","data","results","element","document","createElement","file","Blob","JSON","stringify","type","href","URL","createObjectURL","download","body","appendChild","click","handleChangeFile","fileData","FileReader","onloadend","handleFile","readAsText","e","content","target","result","resultArray","parse","forEach","res","updateResult","state","show","isRegistered","mycars","carOptions","carId","renderDelete","bind","renderInput","fetchMyCars","organizor","user","id","role","DeleteRace","files","setState","restURL","fetch","method","credentials","headers","race","startPos","finishPos","window","location","assign","then","response","json","carOptionsList","Array","from","car","push","maker","model","value","name","length","maxDrivers","circuit","race_date","eor_date","Withdraw","showDetails","event","handleChangeCar","Register"],"mappings":"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","sourcesContent":["import '../styles/Race.css';\r\nimport React, { Component } from \"react\";\r\n\r\nclass Race extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            show: false,\r\n            isRegistered: false,\r\n            mycars : [],\r\n            carOptions : [],\r\n            carId : 0\r\n        }\r\n        this.renderDelete = this.renderDelete.bind(this);\r\n        this.renderInput = this.renderInput.bind(this);\r\n        this.fetchMyCars = this.fetchMyCars.bind(this);\r\n    }\r\n    renderDelete() {\r\n        if ((this.props.data.organizor && (this.props.user.id === this.props.data.organizor.id))\r\n            || this.props.user.id === this.props.data.organizor\r\n            || this.props.user.role === \"ADMIN\") {\r\n            return <button className='delete-button' onClick={() => {\r\n                this.DeleteRace();\r\n            }}>DELETE</button>\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n    }\r\n    renderInput() {\r\n        if ((this.props.data.organizor && (this.props.user.id === this.props.data.organizor.id))\r\n            || this.props.user.id === this.props.data.organizor\r\n            || this.props.user.role === \"ADMIN\") {\r\n            return <label htmlFor=\"file-input\">\r\n            SELECT FILE\r\n            <input id=\"file-input\" type=\"file\" accept=\".txt\" onChange={e =>\r\n                this.handleChangeFile(e.target.files[0])} />\r\n            </label>\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n    }\r\n    isRegistered() {\r\n        this.props.data.results.forEach(element => {\r\n            if ((element.user.id === this.props.user.id)||\r\n            (element.user === this.props.user.id)) {\r\n                this.setState({ isRegistered: true })\r\n            }\r\n        }\r\n        );\r\n    }\r\n    async updateResult(res) {\r\n        const restURL = \"http://localhost:8081/race/rest/results/\";\r\n        await fetch(restURL, {\r\n            method: \"PUT\",\r\n            credentials: 'include',\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            body: JSON.stringify({\r\n                user : {\r\n                    id : res.user.id\r\n                },\r\n                race : {\r\n                    id : res.race\r\n                },\r\n                startPos : res.startPos,\r\n                finishPos : res.finishPos\r\n            })\r\n        })\r\n    }\r\n    async DeleteRace() {\r\n\r\n        const restURL = \"http://localhost:8081/race/rest/races/\" + this.props.data.id;\r\n        await fetch(restURL, {\r\n            method: \"DELETE\",\r\n            credentials: 'include',\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            }\r\n        })\r\n        window.location.assign(\"/upcomingraces\");\r\n    }\r\n    componentDidMount() {\r\n        this.isRegistered();\r\n        this.fetchMyCars();\r\n        \r\n    }\r\n    componentDidUpdate() {\r\n    }\r\n    async fetchMyCars() {\r\n        const restURL = \"http://localhost:8081/race/rest/cars/getMyCars\";\r\n        await fetch(restURL, {\r\n            method: \"GET\",\r\n            credentials: 'include',\r\n            headers: {\r\n                'Accept': 'application/json'\r\n            }\r\n        }).then(response => {\r\n            return response.json()\r\n        })\r\n        .then(data => {\r\n            this.setState({mycars: data})\r\n        })\r\n        let carOptionsList = []\r\n        Array.from(this.state.mycars).forEach(car => {\r\n            carOptionsList.push(<option key={car.id} value={car.id}>{car.maker} {car.model}</option>)\r\n        })\r\n        this.setState({carOptions : carOptionsList});\r\n        if (this.state.mycars[0]) {\r\n            this.setState({ carId: this.state.mycars[0].id });\r\n        }\r\n    }\r\n    async Register() {\r\n        const restURL = \"http://localhost:8081/race/rest/users/registerForRace/\" + this.props.data.id + \"/\" + this.state.carId;\r\n        await fetch(restURL, {\r\n            method: \"POST\",\r\n            credentials: 'include',\r\n            headers: {\r\n                'Accept': 'application/json'\r\n            }\r\n        })\r\n        window.location.assign(\"/upcomingraces\");\r\n    }\r\n\r\n    async Withdraw() {\r\n        const restURL = \"http://localhost:8081/race/rest/users/withdraw/\" + this.props.data.id;\r\n        await fetch(restURL, {\r\n            method: \"POST\",\r\n            credentials: 'include',\r\n            headers: {\r\n                'Accept': 'application/json',\r\n            }\r\n        })\r\n        window.location.assign(\"/upcomingraces\");\r\n    }\r\n    downloadResFile = () => {\r\n        console.log(this.props.data.results)\r\n        const element = document.createElement(\"a\");\r\n        const file = new Blob([JSON.stringify(this.props.data.results, null, 4)], { type: 'text/plain' });\r\n        element.href = URL.createObjectURL(file);\r\n        element.download = \"myFile.txt\";\r\n        document.body.appendChild(element); // Required for this to work in FireFox\r\n        element.click();\r\n    }\r\n\r\n    handleChangeFile = (file) => {\r\n        let fileData = new FileReader();\r\n        fileData.onloadend = this.handleFile;\r\n        fileData.readAsText(file);\r\n    }\r\n    handleChangeCar(value) {\r\n        this.setState({ carId: value });\r\n    }\r\n\r\n    handleFile = (e) => {\r\n        const content = e.target.result;\r\n        console.log(content)\r\n        var resultArray = JSON.parse(content);\r\n        console.log(resultArray);\r\n        resultArray.forEach(res => {\r\n            this.updateResult(res);\r\n        })\r\n        // You can set content in state and show it in render.\r\n    }\r\n    render() {\r\n        if (this.state.isRegistered) {\r\n            return (\r\n                <div className=\"Race\">\r\n                    <p className='Name'>{this.props.data.name}</p>\r\n                    <p className=\"RegDrivers\">Registered : {this.props.data.results.length} / {this.props.data.maxDrivers}</p>\r\n                    <p className=\"Circuit\">Circuit : {this.props.data.circuit.name}</p>\r\n                    <p className=\"Date\">Date of race : {this.props.data.race_date}</p>\r\n                    <p className=\"eorDate\">End of registrations : {this.props.data.eor_date}</p>\r\n                    <div className=\"buttons\">\r\n                        <button className='reg-button' onClick={() => {\r\n                            this.Withdraw();\r\n\r\n                        }}>WITHDRAW</button>\r\n                        <button className='details-button' onClick={() => {\r\n                            this.props.showDetails(this.props.data);\r\n                        }}>DETAILS</button>\r\n                        <this.renderDelete />\r\n                        <button onClick={this.downloadResFile}>DOWNLOAD RESULTS</button>\r\n                    </div>\r\n                    <this.renderInput />\r\n                </div>)\r\n        }\r\n        return (\r\n            <div className=\"Race\">\r\n                <p className='Name'>{this.props.data.name}</p>\r\n                <p className=\"RegDrivers\">Registered : {this.props.data.results.length} / {this.props.data.maxDrivers}</p>\r\n                <p className=\"Circuit\">Circuit : {this.props.data.circuit.name}</p>\r\n                <p className=\"Date\">Date of race : {this.props.data.race_date}</p>\r\n                <p className=\"eorDate\">End of registrations : {this.props.data.eor_date}</p>\r\n                <p>Select your car : </p>\r\n                <select className='carClass-select' onChange={event => this.handleChangeCar(event.target.value)}>\r\n                    {this.state.carOptions}\r\n                </select>\r\n                <div className=\"buttons\">\r\n                    <button className='reg-button' onClick={() => {\r\n                        this.Register();\r\n\r\n                    }}>REGISTER</button>\r\n                    <button className='details-button' onClick={() => {\r\n                        this.props.showDetails(this.props.data);\r\n                    }}>DETAILS</button>\r\n                    <this.renderDelete />\r\n                    <button onClick={this.downloadResFile}>DOWNLOAD RESULTS</button>\r\n                </div>\r\n                <this.renderInput />\r\n            </div>)\r\n    }\r\n}\r\n\r\nexport default Race;"]},"metadata":{},"sourceType":"module"}