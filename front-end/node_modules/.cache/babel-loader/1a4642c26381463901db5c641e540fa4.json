{"ast":null,"code":"var _jsxFileName = \"E:\\\\School\\\\Bc\\\\bakalarka\\\\appka\\\\race-react\\\\src\\\\components\\\\Race.js\";\nimport '../styles/Race.css';\nimport React, { Component } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Race extends Component {\n  constructor(props) {\n    super(props);\n\n    this.downloadResFile = () => {\n      console.log(this.props.data.results);\n      const element = document.createElement(\"a\");\n      const file = new Blob([JSON.stringify(this.props.data.results, null, 4)], {\n        type: 'text/plain'\n      });\n      element.href = URL.createObjectURL(file);\n      element.download = \"myFile.txt\";\n      document.body.appendChild(element); // Required for this to work in FireFox\n\n      element.click();\n    };\n\n    this.handleChangeFile = file => {\n      let fileData = new FileReader();\n      fileData.onloadend = this.handleFile;\n      fileData.readAsText(file);\n    };\n\n    this.handleFile = e => {\n      const content = e.target.result;\n      console.log(content);\n      var resultArray = JSON.parse(content);\n      console.log(resultArray);\n      resultArray.forEach(res => {\n        this.updateResult(res);\n      }); // You can set content in state and show it in render.\n    };\n\n    this.state = {\n      show: false,\n      isRegistered: false,\n      mycars: [],\n      carOptions: [],\n      carId: 0\n    };\n    this.renderDelete = this.renderDelete.bind(this);\n    this.renderInput = this.renderInput.bind(this);\n    this.renderSelect = this.renderSelect.bind(this);\n    this.renderREG = this.renderREG.bind(this);\n    this.fetchMyCars = this.fetchMyCars.bind(this);\n  }\n\n  renderDelete() {\n    if (this.props.data.organizor && this.props.user.id === this.props.data.organizor.id || this.props.user.id === this.props.data.organizor || this.props.user.role === \"ADMIN\") {\n      return /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"delete-button\",\n        onClick: () => {\n          this.DeleteRace();\n        },\n        children: \"DELETE\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 25,\n        columnNumber: 20\n      }, this);\n    } else {\n      return;\n    }\n  }\n\n  renderREG() {\n    if (this.state.isRegistered) {\n      return /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"reg-button\",\n        onClick: () => {\n          this.Withdraw();\n        },\n        children: \"WITHDRAW\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 21\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"reg-button\",\n        onClick: () => {\n          this.Register();\n        },\n        children: \"REGISTER\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 40,\n        columnNumber: 21\n      }, this);\n    }\n  }\n\n  renderInput() {\n    if (this.props.data.organizor && this.props.user.id === this.props.data.organizor.id || this.props.user.id === this.props.data.organizor || this.props.user.role === \"ADMIN\") {\n      return /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"file-input\",\n        children: [\"SELECT FILE\", /*#__PURE__*/_jsxDEV(\"input\", {\n          id: \"file-input\",\n          type: \"file\",\n          accept: \".txt\",\n          onChange: e => this.handleChangeFile(e.target.files[0])\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 51,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 49,\n        columnNumber: 20\n      }, this);\n    } else {\n      return;\n    }\n  }\n\n  renderSelect() {\n    if (!this.state.isRegistered) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Select your car : \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 62,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          className: \"carClass-select\",\n          onChange: event => this.handleChangeCar(event.target.value),\n          children: this.state.carOptions\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 21\n      }, this);\n    }\n  }\n\n  isRegistered() {\n    if (!this.state.isRegistered) {\n      this.props.data.results.forEach(element => {\n        if (element.user.id === this.props.user.id || element.user === this.props.user.id) {\n          this.setState({\n            isRegistered: true\n          });\n        }\n      });\n    }\n  }\n\n  async updateResult(res) {\n    const restURL = \"/rest/results/\";\n    await fetch(restURL, {\n      method: \"PUT\",\n      credentials: 'include',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        user: {\n          id: res.user.id\n        },\n        race: {\n          id: res.race\n        },\n        startPos: res.startPos,\n        finishPos: res.finishPos\n      })\n    });\n  }\n\n  async DeleteRace() {\n    const restURL = \"/rest/races/\" + this.props.data.id;\n    await fetch(restURL, {\n      method: \"DELETE\",\n      credentials: 'include',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    });\n    window.location.assign(\"/upcomingraces\");\n  }\n\n  componentDidMount() {\n    this.fetchMyCars();\n    this.isRegistered();\n  }\n\n  componentDidUpdate() {}\n\n  async fetchMyCars() {\n    const restURL = \"/rest/cars/getMyCars\";\n    await fetch(restURL, {\n      method: \"GET\",\n      credentials: 'include',\n      headers: {\n        'Accept': 'application/json'\n      }\n    }).then(response => {\n      return response.json();\n    }).then(data => {\n      this.setState({\n        mycars: data\n      });\n      data.forEach(car => {\n        if (this.props.data.classes.indexOf(car.carClass) > -1) {\n          this.setState(prevState => ({\n            carOptions: [prevState.carOptions, /*#__PURE__*/_jsxDEV(\"option\", {\n              value: car.id,\n              children: [car.maker, \" \", car.model]\n            }, car.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 137,\n              columnNumber: 63\n            }, this)]\n          }));\n        }\n      });\n\n      if (data[0]) {\n        this.setState({\n          carId: data[0].id\n        });\n      }\n    });\n  }\n\n  async Register() {\n    const restURL = \"/rest/users/registerForRace/\" + this.props.data.id + \"/\" + this.state.carId;\n    await fetch(restURL, {\n      method: \"POST\",\n      credentials: 'include',\n      headers: {\n        'Accept': 'application/json'\n      }\n    });\n    window.location.assign(\"/upcomingraces\");\n  }\n\n  async Withdraw() {\n    const restURL = \"/rest/users/withdraw/\" + this.props.data.id;\n    await fetch(restURL, {\n      method: \"POST\",\n      credentials: 'include',\n      headers: {\n        'Accept': 'application/json'\n      }\n    });\n    window.location.assign(\"/upcomingraces\");\n  }\n\n  handleChangeCar(value) {\n    this.setState({\n      carId: value\n    });\n  }\n\n  render() {\n    this.isRegistered();\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Race\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"Name\",\n        children: this.props.data.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"RegDrivers\",\n        children: [\"Registered : \", this.props.data.results.length, \" / \", this.props.data.maxDrivers]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"Circuit\",\n        children: [\"Circuit : \", this.props.data.circuit.name]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"Date\",\n        children: [\"Date of race : \", this.props.data.race_date]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"eorDate\",\n        children: [\"End of registrations : \", this.props.data.eor_date]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(this.renderSelect, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"buttons\",\n        children: [/*#__PURE__*/_jsxDEV(this.renderREG, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"details-button\",\n          onClick: () => {\n            this.props.showDetails(this.props.data);\n          },\n          children: \"DETAILS\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(this.renderDelete, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.downloadResFile,\n          children: \"DOWNLOAD RESULTS\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(this.renderInput, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 17\n      }, this)]\n    }, this.props.data.name, true, {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Race;","map":{"version":3,"sources":["E:/School/Bc/bakalarka/appka/race-react/src/components/Race.js"],"names":["React","Component","Race","constructor","props","downloadResFile","console","log","data","results","element","document","createElement","file","Blob","JSON","stringify","type","href","URL","createObjectURL","download","body","appendChild","click","handleChangeFile","fileData","FileReader","onloadend","handleFile","readAsText","e","content","target","result","resultArray","parse","forEach","res","updateResult","state","show","isRegistered","mycars","carOptions","carId","renderDelete","bind","renderInput","renderSelect","renderREG","fetchMyCars","organizor","user","id","role","DeleteRace","Withdraw","Register","files","event","handleChangeCar","value","setState","restURL","fetch","method","credentials","headers","race","startPos","finishPos","window","location","assign","componentDidMount","componentDidUpdate","then","response","json","car","classes","indexOf","carClass","prevState","maker","model","render","name","length","maxDrivers","circuit","race_date","eor_date","showDetails"],"mappings":"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","sourcesContent":["import '../styles/Race.css';\r\nimport React, { Component } from \"react\";\r\n\r\nclass Race extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            show: false,\r\n            isRegistered: false,\r\n            mycars: [],\r\n            carOptions: [],\r\n            carId: 0\r\n        }\r\n        this.renderDelete = this.renderDelete.bind(this);\r\n        this.renderInput = this.renderInput.bind(this);\r\n        this.renderSelect = this.renderSelect.bind(this);\r\n        this.renderREG = this.renderREG.bind(this);\r\n        this.fetchMyCars = this.fetchMyCars.bind(this);\r\n    }\r\n    renderDelete() {\r\n        if ((this.props.data.organizor && (this.props.user.id === this.props.data.organizor.id))\r\n            || this.props.user.id === this.props.data.organizor\r\n            || this.props.user.role === \"ADMIN\") {\r\n            return <button className='delete-button' onClick={() => {\r\n                this.DeleteRace();\r\n            }}>DELETE</button>\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n    }\r\n    renderREG() {\r\n        if (this.state.isRegistered) {\r\n            return (<button className='reg-button' onClick={() => {\r\n                this.Withdraw();\r\n            }}>WITHDRAW</button>)\r\n        }\r\n        else {\r\n            return (<button className='reg-button' onClick={() => {\r\n                this.Register();\r\n            }}>REGISTER</button>)\r\n        }\r\n    }\r\n    renderInput() {\r\n        if ((this.props.data.organizor && (this.props.user.id === this.props.data.organizor.id))\r\n            || this.props.user.id === this.props.data.organizor\r\n            || this.props.user.role === \"ADMIN\") {\r\n            return <label htmlFor=\"file-input\">\r\n                SELECT FILE\r\n                <input id=\"file-input\" type=\"file\" accept=\".txt\" onChange={e =>\r\n                    this.handleChangeFile(e.target.files[0])} />\r\n            </label>\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n    }\r\n    renderSelect() {\r\n        if (!this.state.isRegistered) {\r\n            return (<div>\r\n                <p>Select your car : </p>\r\n                <select className='carClass-select' onChange={event => this.handleChangeCar(event.target.value)}>\r\n                    {this.state.carOptions}\r\n                </select>\r\n            </div>)\r\n        }\r\n\r\n    }\r\n    isRegistered() {\r\n        if(!this.state.isRegistered){\r\n            this.props.data.results.forEach(element => {\r\n                if ((element.user.id === this.props.user.id) ||\r\n                    (element.user === this.props.user.id)) {\r\n                    this.setState({ isRegistered: true })\r\n                }\r\n            }\r\n            );\r\n        }\r\n    }\r\n    async updateResult(res) {\r\n        const restURL = \"/rest/results/\";\r\n        await fetch(restURL, {\r\n            method: \"PUT\",\r\n            credentials: 'include',\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            body: JSON.stringify({\r\n                user: {\r\n                    id: res.user.id\r\n                },\r\n                race: {\r\n                    id: res.race\r\n                },\r\n                startPos: res.startPos,\r\n                finishPos: res.finishPos\r\n            })\r\n        })\r\n    }\r\n    async DeleteRace() {\r\n\r\n        const restURL = \"/rest/races/\" + this.props.data.id;\r\n        await fetch(restURL, {\r\n            method: \"DELETE\",\r\n            credentials: 'include',\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            }\r\n        })\r\n        window.location.assign(\"/upcomingraces\");\r\n    }\r\n    componentDidMount() {\r\n        this.fetchMyCars();\r\n        this.isRegistered();\r\n    }\r\n    componentDidUpdate() {\r\n    }\r\n    async fetchMyCars() {\r\n        const restURL = \"/rest/cars/getMyCars\";\r\n        await fetch(restURL, {\r\n            method: \"GET\",\r\n            credentials: 'include',\r\n            headers: {\r\n                'Accept': 'application/json'\r\n            }\r\n        }).then(response => {\r\n            return response.json()\r\n        })\r\n            .then(data => {\r\n                this.setState({ mycars: data })\r\n                data.forEach(car => {\r\n                    if (this.props.data.classes.indexOf(car.carClass) > -1) {\r\n                        this.setState(prevState =>\r\n                        ({ carOptions: [prevState.carOptions, <option key={car.id} value={car.id}>{car.maker} {car.model}</option>] }\r\n                        ));\r\n                    }\r\n                })\r\n                if (data[0]) {\r\n                    this.setState({ carId: data[0].id });\r\n                }\r\n            })\r\n    }\r\n    async Register() {\r\n        const restURL = \"/rest/users/registerForRace/\" + this.props.data.id + \"/\" + this.state.carId;\r\n        await fetch(restURL, {\r\n            method: \"POST\",\r\n            credentials: 'include',\r\n            headers: {\r\n                'Accept': 'application/json'\r\n            }\r\n        })\r\n        window.location.assign(\"/upcomingraces\");\r\n    }\r\n\r\n    async Withdraw() {\r\n        const restURL = \"/rest/users/withdraw/\" + this.props.data.id;\r\n        await fetch(restURL, {\r\n            method: \"POST\",\r\n            credentials: 'include',\r\n            headers: {\r\n                'Accept': 'application/json',\r\n            }\r\n        })\r\n        window.location.assign(\"/upcomingraces\");\r\n    }\r\n    downloadResFile = () => {\r\n        console.log(this.props.data.results)\r\n        const element = document.createElement(\"a\");\r\n        const file = new Blob([JSON.stringify(this.props.data.results, null, 4)], { type: 'text/plain' });\r\n        element.href = URL.createObjectURL(file);\r\n        element.download = \"myFile.txt\";\r\n        document.body.appendChild(element); // Required for this to work in FireFox\r\n        element.click();\r\n    }\r\n\r\n    handleChangeFile = (file) => {\r\n        let fileData = new FileReader();\r\n        fileData.onloadend = this.handleFile;\r\n        fileData.readAsText(file);\r\n    }\r\n    handleChangeCar(value) {\r\n        this.setState({ carId: value });\r\n    }\r\n\r\n    handleFile = (e) => {\r\n        const content = e.target.result;\r\n        console.log(content)\r\n        var resultArray = JSON.parse(content);\r\n        console.log(resultArray);\r\n        resultArray.forEach(res => {\r\n            this.updateResult(res);\r\n        })\r\n        // You can set content in state and show it in render.\r\n    }\r\n    render() {\r\n        this.isRegistered()\r\n        return (\r\n            <div className=\"Race\" key={this.props.data.name}>\r\n                <p className='Name'>{this.props.data.name}</p>\r\n                <p className=\"RegDrivers\">Registered : {this.props.data.results.length} / {this.props.data.maxDrivers}</p>\r\n                <p className=\"Circuit\">Circuit : {this.props.data.circuit.name}</p>\r\n                <p className=\"Date\">Date of race : {this.props.data.race_date}</p>\r\n                <p className=\"eorDate\">End of registrations : {this.props.data.eor_date}</p>\r\n                <this.renderSelect />\r\n                <div className=\"buttons\">\r\n                    <this.renderREG/>\r\n                    <button className='details-button' onClick={() => {\r\n                        this.props.showDetails(this.props.data);\r\n                    }}>DETAILS</button>\r\n                    <this.renderDelete />\r\n                    <button onClick={this.downloadResFile}>DOWNLOAD RESULTS</button>\r\n                </div>\r\n                <this.renderInput />\r\n            </div>)\r\n    }\r\n}\r\n\r\nexport default Race;"]},"metadata":{},"sourceType":"module"}